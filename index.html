<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Crypto Survivor: To The Moon</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    
    <!-- Ajout de la bibliothèque Tone.js pour l'audio -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Menu Principal -->
    <div id="main-menu-screen" class="screen active">
        <div class="screen-content">
            <h1>Crypto Survivor</h1>
            <div class="menu-buttons">
                <button id="start-game-button" class="action-button">Survivor Mode</button>
                <button id="multiplayer-button" class="action-button">Multijoueur</button>
                <button id="shop-button" class="action-button">Boutique</button>
                <button id="options-button" class="action-button" disabled>Options</button>
            </div>
        </div>
    </div>

    <!-- Écran de Boutique -->
    <div id="shop-screen" class="screen">
        <div class="screen-content">
            <h1>Boutique</h1>
            <p>Améliorations Permanentes</p>
            <div id="shop-wallet-display">0</div>
            <div id="shop-items-container">
                            </div>
            <button id="back-to-menu-button" class="action-button">Retour</button>
        </div>
    </div>

    <!-- Écran de sélection du personnage -->
    <div id="character-selection-screen" class="screen">
        <div class="screen-content">
            <h1>Crypto Survivor</h1>
            <p>Choisissez votre Crypto</p>
            <div class="character-choices" id="character-choices-container">
                            </div>
            <button id="back-to-menu-from-char-select-button" class="action-button">Retour</button>
        </div>
    </div>

    <!-- Écran de Sélection de Mode Multijoueur -->
    <div id="multiplayer-mode-screen" class="screen">
        <div class="screen-content">
            <h2>Choisissez un mode</h2>
            <div class="menu-buttons">
                <button id="army-attack-button" class="action-button">Army Attaque</button>
                <button class="action-button" disabled>Tower Defence</button>
                <button class="action-button" disabled>Coming Soon</button>
                <button class="action-button" disabled>Coming Soon</button>
            </div>
            <button id="back-to-menu-from-mode-select-button" class="action-button" style="background-color: var(--disabled-color);">Retour</button>
        </div>
    </div>

    <!-- Écran de Sélection de Carte -->
    <div id="map-selection-screen" class="screen">
        <div class="screen-content">
            <h2>Choisissez une carte</h2>
            <div class="map-choices">
                <div class="map-option" data-map-id="quadrant_4p">
                    <div class="map-preview">
                        <div class="map-preview-line-v"></div>
                        <div class="map-preview-line-h"></div>
                    </div>
                    <strong>Arène 4 Joueurs</strong>
                    <span>4 Joueurs</span>
                </div>
                 <div class="map-option" data-map-id="vertical_2p">
                    <div class="map-preview">
                        <div class="map-preview-line-h"></div>
                    </div>
                    <strong>Duel Vertical</strong>
                    <span>2 Joueurs</span>
                </div>
            </div>
            <div class="menu-buttons">
                 <button id="next-from-map-select-button" class="action-button" disabled>Suivant</button>
                 <button id="back-to-menu-from-map-select-button" class="action-button" style="background-color: var(--disabled-color);">Retour</button>
            </div>
        </div>
    </div>
    
    <!-- Écran du Lobby Multijoueur -->
    <div id="multiplayer-lobby-screen" class="screen">
        <div class="screen-content">
            <h2>Multijoueur</h2>
            <div class="form-group">
                <label for="player-name-input">Pseudo</label>
                <input type="text" id="player-name-input" placeholder="Votre pseudo..." maxlength="12">
            </div>
            <div class="form-group">
                <label for="game-id-input">ID de la partie</label>
                <input type="text" id="game-id-input" placeholder="Entrez un ID pour rejoindre...">
            </div>
            <button id="join-game-button" class="action-button" disabled>Rejoindre</button>
            <button id="create-game-button" class="action-button">Créer une partie</button>
            <button id="back-to-menu-from-lobby-button" class="action-button" style="background-color: var(--disabled-color);">Retour</button>
        </div>
    </div>

    <!-- Écran du Salon d'attente -->
    <div id="waiting-room-screen" class="screen">
        <div class="screen-content">
            <h2>Salon d'attente</h2>
            <p id="waiting-room-info">ID de la partie : <span id="game-id-display"></span></p>
            <h3>Joueurs (1/4)</h3>
            <ul id="player-list">
                                <li>Votre Pseudo (Hôte)</li>
            </ul>
            <div class="menu-buttons">
                <button id="start-vs-ai-button" class="action-button">Jouer contre l'IA</button>
                <button id="start-multiplayer-game-button" class="action-button" disabled>Lancer la partie (2+ Joueurs)</button>
                <button id="back-to-lobby-from-waiting-button" class="action-button" style="background-color: var(--disabled-color);">Retour</button>
            </div>
        </div>
    </div>


    <!-- Écran de Pause -->
    <div id="pause-screen" class="screen">
        <div class="screen-content">
            <h2>PAUSE</h2>
            <div class="menu-buttons">
                <button id="resume-button" class="action-button">Continuer</button>
                <button id="restart-from-pause-button" class="action-button">Recommencer</button>
                <button id="main-menu-from-pause-button" class="action-button">Menu Principal</button>
            </div>
        </div>
    </div>

    <!-- Écran de Confirmation pour Quitter -->
    <div id="confirm-quit-screen" class="screen">
        <div class="screen-content">
            <h2>Quitter la partie ?</h2>
            <p>Votre progression dans cette partie sera perdue.</p>
            <div style="display: flex; justify-content: center; gap: 20px;">
                <button id="confirm-quit-yes-button" class="action-button">Oui</button>
                <button id="confirm-quit-no-button" class="action-button" style="background-color: var(--disabled-color);">Non</button>
            </div>
        </div>
    </div>

    <!-- Interface du jeu (HUD) -->
    <div id="game-hud" class="hidden">
        <div id="hud-left-column">
            <div id="stats-container">
                <div id="stats-left">
                    <div>LVL: <span id="player-level">1</span></div>
                    <div>$<span class="mvx-logo-inline">X</span> <span id="player-wallet">0</span></div>
                </div>
                <div id="game-timer">00:00</div>
            </div>
            <div id="top-health-bar">
                <div id="top-health-bar-fill"></div>
                <span id="top-health-bar-text">100 / 100</span>
            </div>
            <div id="xp-bar-container">
                <div id="xp-bar"></div>
                <span id="xp-bar-text">0 / 10</span>
            </div>
        </div>
        <div id="hud-right-column">
            <canvas id="minimap-canvas" width="80" height="80"></canvas>
            <button id="pause-button" class="game-ui-button">||</button>
        </div>
    </div>
    <div id="bonus-timer" class="hidden"></div>

    <!-- Panneau d'Améliorations (Gauche) -->
    <div id="upgrade-panel" class="side-panel hidden">
        <button id="upgrade-panel-toggle" class="side-panel-toggle"><span>◀</span></button>
        <div id="skill-points-display">Points: 0</div>
        <div id="multiplayer-upgrades-container">
                    </div>
    </div>

    <!-- Panneau d'Achat d'Armée (Droite) -->
    <div id="army-purchase-panel" class="side-panel hidden">
        <button id="army-panel-toggle" class="side-panel-toggle"><span>▶</span></button>
        <h3>Construire Armée</h3>
        <div class="army-unit-button" data-unit="triangle">
            <span class="unit-shape">▲</span>
            <div class="unit-info">
                <span class="unit-name">Mitrailleur</span>
                <span class="unit-cost">50 $<span class="mvx-logo-inline">X</span></span>
            </div>
        </div>
        <div class="army-unit-button" data-unit="square">
            <span class="unit-shape">■</span>
            <div class="unit-info">
                <span class="unit-name">Artilleur</span>
                <span class="unit-cost">100 $<span class="mvx-logo-inline">X</span></span>
            </div>
        </div>
        <div class="army-unit-button" data-unit="rectangle">
            <span class="unit-shape">▬</span>
            <div class="unit-info">
                <span class="unit-name">Lance-Missiles</span>
                <span class="unit-cost">150 $<span class="mvx-logo-inline">X</span></span>
            </div>
        </div>
        <h3 id="fusion-title" class="hidden">Fusionner</h3>
        <div id="fusion-options-container">
                      </div>
    </div>


    <!-- Écran de montée de niveau -->
    <div id="level-up-screen" class="screen">
        <div class="screen-content">
            <h2 id="level-up-title">LEVEL UP!</h2>
            <p id="level-up-subtitle">Choisissez une seule amélioration :</p>
            <div id="level-up-options"></div>
            <button id="confirm-upgrade-button" class="action-button hidden">Confirmer</button>
        </div>
    </div>

    <!-- Écran de fin de partie -->
    <div id="game-over-screen" class="screen">
        <div class="screen-content">
            <h2 id="game-over-title">LIQUIDATED!</h2>
            <div id="survivor-stats">
                <p>Vous avez survécu <span id="final-time">00:00</span>.</p>
                <p>Niveau final : <span id="final-level">1</span></p>
                <p>Gains : <span id="final-gain">0</span> $<span class="mvx-logo-inline">X</span></p>
            </div>
            <div id="game-over-buttons" class="menu-buttons">
                                <button id="restart-button" class="action-button">Menu Principal</button>
                                <button id="game-over-lobby-button" class="action-button hidden">Lobby</button>
                <button id="game-over-spectate-button" class="action-button hidden">Mode Spectateur</button>
                <button id="game-over-quit-button" class="action-button hidden">Menu Principal</button>
            </div>
        </div>
    </div>
    
    <!-- Affichages UI en jeu -->
    <div id="passive-upgrades-display" class="hidden"></div>
    <div id="weapon-display-ui" class="hidden"></div>

    <!-- Éléments du jeu -->
    <canvas id="game-canvas"></canvas>
    <div id="joystick-container"><div id="joystick-handle"></div></div>
    <button id="special-ability-button" class="hidden">🚀</button>
    <button id="mute-button" class="game-ui-button">🎵</button>
    
    <!-- Barre de chargement du Pentagramme -->
    <div id="pentagram-charge-container" class="hidden">
        <div id="pentagram-charge-bar"></div>
        <span id="pentagram-charge-text">Invocation...</span>
    </div>

    <!-- Scripts du jeu -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/save.js"></script>
    <script src="js/entities.js"></script>
    <script src="js/weapons.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>